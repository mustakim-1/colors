<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura Palette Designer - Titan Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">

<!--
/**************************************************************
*
*   STYLES - TITAN EDITION (FINAL GUIDANCE UPDATE)
*
**************************************************************/
-->
    <style>
        :root {
            --bg-color: #101012;
            --sidebar-bg: #151518;
            --card-bg-color: rgba(28, 29, 34, 0.6);
            --text-color: #e1e1e6;
            --text-muted: #a8a8b3;
            --primary-accent: #5086f7;
            --border-color: rgba(255, 255, 255, 0.08);
            --success-color: #00b37e;
            --fail-color: #f75a68;
            --font-family: 'Inter', sans-serif;
            --font-family-mono: 'Fira Code', monospace;
            --card-border-radius: 16px;
            --control-border-radius: 10px;
            --aura-color-1: rgba(80, 134, 247, 0.15);
            --aura-color-2: rgba(148, 86, 240, 0.15);
            --aura-color-3: rgba(240, 86, 162, 0.15);
        }

        /* --- Color Blindness Filters --- */
        body.protanopia { filter: url(#protanopia); }
        body.deuteranopia { filter: url(#deuteranopia); }
        body.tritanopia { filter: url(#tritanopia); }
        body.achromatopsia { filter: url(#achromatopsia); }

        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background-color: rgba(255, 255, 255, 0.15); }

        /* --- 1. Base & Layout --- */
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            margin: 0;
            font-size: 16px;
            min-height: 100vh;
            box-sizing: border-box;
            background-attachment: fixed;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 15% 20%, var(--aura-color-1), transparent 40%),
                radial-gradient(circle at 85% 30%, var(--aura-color-2), transparent 40%),
                radial-gradient(circle at 50% 90%, var(--aura-color-3), transparent 40%);
            z-index: -1;
            opacity: 0.8;
            transition: all 1.5s cubic-bezier(0.25, 1, 0.5, 1);
            animation: aura-breathe 15s ease-in-out infinite alternate;
        }
        @keyframes aura-breathe {
            from { transform: scale(1); opacity: 0.6; }
            to { transform: scale(1.2); opacity: 1; }
        }

        .main-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            padding: clamp(1rem, 5vw, 3rem);
        }

        @media (min-width: 1200px) {
            .main-wrapper {
                grid-template-columns: 1fr 380px;
                gap: 2.5rem;
                padding: clamp(1.5rem, 5vw, 4rem);
            }
        }
        .main-content { min-width: 0; }
        .sidebar { display: flex; flex-direction: column; gap: 2.5rem; }

        .page-header { text-align: center; margin-bottom: 2rem; }
        .page-header h1 {
            margin: 0; font-size: clamp(2.5rem, 6vw, 4rem); font-weight: 700;
            background: linear-gradient(90deg, #c4c4cc, #ffffff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: fadeInHeader 1s ease-out;
        }
        @keyframes fadeInHeader { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .page-header p { margin-top: 0.5rem; color: var(--text-muted); font-size: 1.1rem; max-width: 750px; margin: 0.5rem auto 1.5rem; line-height: 1.6; animation: fadeInHeader 1s 0.2s ease-out backwards;}
        
        .simulation-control { display: flex; align-items: center; justify-content: center; gap: 0.75rem; font-size: 0.9rem; }
        .simulation-control select {
            background-color: var(--card-bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.4rem 0.8rem;
            font-family: var(--font-family);
            cursor: pointer;
        }

        /* --- 2. Controls Panel --- */
        .controls {
            background: var(--card-bg-color); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            padding: 1.25rem; border-radius: var(--card-border-radius);
            border: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 1.25rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: sticky; top: 1.5rem; z-index: 10;
        }
        .controls-row { display: flex; flex-wrap: wrap; align-items: center; gap: 1.25rem 1.5rem; width: 100%; }
        .control-group { display: flex; align-items: center; gap: 1rem; flex-grow: 1; min-width: 180px; }
        .control-group label { font-weight: 500; white-space: nowrap; color: var(--text-muted); }
        .control-group-label { font-size: 0.8rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; width: 100%; margin-bottom: -0.5rem; }
        
        input[type="color"] { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 2px solid var(--border-color); -webkit-appearance: none; -moz-appearance: none; appearance: none; background-color: transparent; padding: 0; overflow: hidden; transition: transform 0.2s ease; }
        input[type="color"]:hover { transform: scale(1.1); }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 50%; padding: 0; }
        input[type="color"]::-moz-color-swatch { border: none; border-radius: 50%; }

        .slider-group { flex-grow: 1; min-width: 140px; }
        .slider-group div { display: flex; justify-content: space-between; margin-bottom: 0.25rem; font-size: 0.9rem;}
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 6px; background: rgba(0,0,0,0.3); border-radius: 5px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: var(--text-color); border-radius: 50%; cursor: pointer; transition: background 0.2s; }
        input[type="range"]::-webkit-slider-thumb:hover { background: white; }
        input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; background: var(--text-color); border-radius: 50%; cursor: pointer; border: none; }
        
        .toggle-buttons { display: flex; background-color: rgba(0,0,0,0.3); padding: 0.4rem; border-radius: var(--control-border-radius); }
        .toggle-buttons button { flex-grow: 1; background-color: transparent; color: var(--text-muted); border: none; padding: 0.5rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; font-size: 0.85rem; }
        .toggle-buttons button:hover { background-color: var(--border-color); color: var(--text-color); }
        .toggle-buttons button.active { background-color: var(--primary-accent); color: white; box-shadow: 0 0 10px rgba(80, 134, 247, 0.5); }
        
        .action-buttons { justify-content: flex-end; }
        .action-buttons button { background-color: rgba(255, 255, 255, 0.05); color: var(--text-muted); border: 1px solid var(--border-color); height: 40px; padding: 0 1rem; border-radius: var(--control-border-radius); cursor: pointer; transition: all 0.2s ease; display: flex; justify-content: center; align-items: center; gap: 0.5rem; }
        .action-buttons button:hover { background-color: var(--border-color); color: var(--text-color); transform: translateY(-2px); }
        .action-buttons button:active { transform: translateY(0); }
        .action-buttons button svg { width: 20px; height: 20px; }

        /* --- 3. Palette Grid & Cards --- */
        .palette-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1.5rem; perspective: 1000px; }
        .color-card {
            background-color: var(--card-bg-color); border-radius: var(--card-border-radius);
            overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.4s ease;
            opacity: 0; animation: cardFlipIn 0.6s ease-out forwards;
        }
        @keyframes cardFlipIn { 
            from { opacity: 0; transform: rotateX(-30deg) translateY(30px); }
            to { opacity: 1; transform: rotateX(0deg) translateY(0); }
        }
        .color-card:hover { transform: translateY(-10px); box-shadow: 0 15px 40px rgba(0,0,0,0.4), 0 0 40px var(--glow-color, transparent); }
        .card__header { padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: center; }
        .card__name { font-size: 1.05rem; font-weight: 600; text-transform: capitalize; }
        .card__name .loading-dots span { animation: blink 1.4s infinite both; }
        .card__name .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .card__name .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0% { opacity: .2; } 20% { opacity: 1; } 100% { opacity: .2; } }
        .lock-btn { background: rgba(0,0,0,0.3); border: 1px solid transparent; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: all 0.2s ease; flex-shrink: 0; }
        .lock-btn:hover { background: rgba(0,0,0,0.5); transform: scale(1.1); }
        .lock-btn svg { fill: white; opacity: 0.8; width: 20px; height: 20px;}
        .lock-btn.locked { background: var(--primary-accent); }
        .card__swatch { height: 100px; }
        .card__info { padding: 0.75rem 1rem 1rem; display: flex; flex-direction: column; gap: 0.75rem; flex-grow: 1; }
        .color-codes-wrapper { display: flex; flex-direction: column; gap: 0.5rem; }
        .color-code { font-family: var(--font-family-mono); cursor: pointer; padding: 0.3rem 0.5rem; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.2s; position: relative; font-size: 0.9rem;}
        .color-code:hover { background-color: var(--border-color); }
        .color-code .type { color: var(--text-muted); font-weight: bold; text-transform: uppercase; }
        .primary-code { font-weight: bold; border: 1px solid var(--primary-accent); background-color: rgba(80, 134, 247, 0.1); }
        .primary-code .type { color: var(--primary-accent); }
        .color-code.copied { background-color: var(--success-color) !important; color: white; border-color: var(--success-color) !important; }
        .color-code.copied .type, .color-code.copied .value { color: white !important; }

        /* --- 4. Sidebar Sections --- */
        .sidebar-section { background: var(--sidebar-bg); border: 1px solid var(--border-color); border-radius: var(--card-border-radius); padding: 1.25rem; }
        .sidebar-section h3 { margin: 0 0 1rem 0; font-size: 1.1rem; }
        
        /* NEW: "How to Use" Guide */
        .how-to-guide { display: flex; flex-direction: column; gap: 1rem; }
        .how-to-step { display: flex; align-items: flex-start; gap: 1rem; }
        .how-to-step .icon { color: var(--primary-accent); width: 24px; height: 24px; flex-shrink: 0; margin-top: 2px; }
        .how-to-step-content h4 { font-size: 0.95rem; margin: 0 0 0.25rem; }
        .how-to-step-content p { font-size: 0.85rem; color: var(--text-muted); margin: 0; line-height: 1.6; }
        .how-to-step-content p strong { color: var(--text-color); font-weight: 500; }
        
        /* Revamped Palette Guide */
        #paletteGuideContent .tip-text { color: var(--text-muted); font-size: 0.9rem; line-height: 1.6; margin-bottom: 1rem; }
        #paletteGuideContent .tip-text strong { color: var(--primary-accent); font-weight: 600; }
        .usage-example {
            --example-dom-color: #333; --example-sec-color: #555; --example-acc-color: #888;
            background: rgba(0,0,0,0.2); padding: 0.75rem; border-radius: 8px; margin-top: 1rem;
        }
        .usage-example h4 { font-size: 0.85rem; margin: 0 0 0.75rem; text-align: center; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .usage-example-dominant {
            background: var(--example-dom-color);
            padding: 0.75rem; border-radius: 6px; position: relative;
            transition: background-color 0.4s ease;
        }
        .usage-example-secondary {
            background: var(--example-sec-color);
            min-height: 50px; border-radius: 4px; position: relative;
            transition: background-color 0.4s ease;
        }
        .usage-example-accent {
            position: absolute; bottom: -12px; right: 10px;
            background: var(--example-acc-color);
            width: 24px; height: 24px; border-radius: 50%;
            border: 2px solid var(--example-dom-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: background-color 0.4s ease, border-color 0.4s ease;
        }
        .usage-label {
            position: absolute; top: 4px; left: 4px;
            font-size: 0.7rem; font-weight: 600; font-family: var(--font-family-mono);
            background: rgba(0,0,0,0.4); color: white;
            padding: 2px 5px; border-radius: 4px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .usage-example-accent .usage-label { top: -22px; left: 50%; transform: translateX(-50%); white-space: nowrap; }
        
        /* Live Preview */
        .preview-card { 
            --preview-bg: #202124; --preview-text: #e8eaed; --preview-accent: #8ab4f8; --preview-border: #5f6368;
            background-color: var(--preview-bg); padding: 1rem; border-radius: 10px; color: var(--preview-text);
            border: 1px solid var(--preview-border);
            transition: all 0.5s ease;
        }
        .preview-card h4 { margin: 0 0 0.5rem 0; color: var(--preview-text); font-size: 1.25rem; }
        .preview-card p { margin: 0 0 1rem 0; font-size: 0.9rem; color: var(--text-muted); line-height: 1.5; }
        .preview-button {
            background-color: var(--preview-accent); color: var(--bg-color); border: none; padding: 0.6rem 1rem;
            border-radius: 8px; font-weight: 600; cursor: default;
        }
        
        /* Gradients */
        .gradients-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        .gradient-swatch { height: 60px; border-radius: 8px; cursor: pointer; transition: transform 0.2s ease; }
        .gradient-swatch:hover { transform: scale(1.05); }

        /* Favorites */
        #favoritesList { display: flex; flex-direction: column; gap: 0.75rem; max-height: 250px; overflow-y: auto; padding-right: 0.5rem; }
        .favorite-item { display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; }
        .favorite-item:hover { background-color: rgba(0,0,0,0.4); }
        .favorite-info { display: flex; align-items: center; gap: 0.75rem; }
        .favorite-name { font-weight: 500; font-size: 0.9rem; }
        .favorite-swatches { display: flex; }
        .favorite-swatch { width: 18px; height: 18px; border-radius: 4px; margin-left: -6px; border: 2px solid var(--sidebar-bg); }
        .delete-fav-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 0.25rem; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;}
        .delete-fav-btn:hover { background: var(--fail-color); color: white; }
        #noFavoritesMessage { font-size: 0.9rem; color: var(--text-muted); text-align: center; padding: 1rem 0; }
        
        /* --- Modal & Utilities --- */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 1000; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal { background: var(--card-bg-color); padding: 2rem; border-radius: var(--card-border-radius); border: 1px solid var(--border-color); width: 90%; max-width: 600px; transform: scale(0.95) translateY(10px); transition: all 0.3s ease; box-shadow: 0 20px 50px rgba(0,0,0,0.4); }
        .modal-overlay.visible .modal { transform: scale(1) translateY(0); }
        .modal h2 { margin-top: 0; }
        .modal-tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; border-radius: var(--control-border-radius); background: rgba(0,0,0,0.3); padding: 0.5rem; }
        .modal-tabs button { flex-grow: 1; background: transparent; color: var(--text-muted); border: none; padding: 0.75rem; border-radius: 6px; cursor: pointer; transition: all 0.2s; font-weight: 500; }
        .modal-tabs button.active { background: var(--primary-accent); color: white; }
        #exportOutput { width: 100%; height: 250px; background: var(--bg-color); color: var(--text-color); border: 1px solid var(--border-color); border-radius: var(--control-border-radius); font-family: var(--font-family-mono); padding: 1rem; box-sizing: border-box; resize: vertical; }
        .modal-actions { margin-top: 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .modal-actions button { background: rgba(255, 255, 255, 0.05); color: var(--text-muted); border: 1px solid var(--border-color); padding: 0.75rem 1.5rem; border-radius: var(--control-border-radius); cursor: pointer; transition: all 0.2s; }
        .modal-actions button#copyExportBtn { background-color: var(--primary-accent); color: white; border-color: var(--primary-accent); }
        .copy-feedback { color: var(--success-color); opacity: 0; transition: opacity 0.3s; font-weight: 500; }

        [data-tooltip] { position: relative; }
        [data-tooltip]::after {
            content: attr(data-tooltip); position: absolute; bottom: 125%; left: 50%;
            background: #202124; color: white; padding: 6px 12px; border-radius: 8px; font-size: 0.85rem;
            white-space: nowrap; opacity: 0; visibility: hidden; transition: opacity 0.2s 0.3s, transform 0.2s 0.3s;
            pointer-events: none; z-index: 1001; transform: translateX(-50%) translateY(5px);
        }
        [data-tooltip]:hover::after { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>
    <!-- SVG Filters for Color Blindness Simulation -->
    <svg id="colorblind-filters" style="display: none">
      <defs>
        <filter id="protanopia"><feColorMatrix type="matrix" values="0.567, 0.433, 0, 0, 0, 0.558, 0.442, 0, 0, 0, 0, 0.242, 0.758, 0, 0, 0, 0, 0, 1, 0"/></filter>
        <filter id="deuteranopia"><feColorMatrix type="matrix" values="0.625, 0.375, 0, 0, 0, 0.7, 0.3, 0, 0, 0, 0, 0.3, 0.7, 0, 0, 0, 0, 0, 1, 0"/></filter>
        <filter id="tritanopia"><feColorMatrix type="matrix" values="0.95, 0.05, 0, 0, 0, 0, 0.433, 0.567, 0, 0, 0, 0.475, 0.525, 0, 0, 0, 0, 0, 1, 0"/></filter>
        <filter id="achromatopsia"><feColorMatrix type="matrix" values="0.299, 0.587, 0.114, 0, 0, 0.299, 0.587, 0.114, 0, 0, 0.299, 0.587, 0.114, 0, 0, 0, 0, 0, 1, 0"/></filter>
      </defs>
    </svg>

    <div class="main-wrapper">
        <div class="main-content">
            <header class="page-header">
                <h1>Aura Palette Designer</h1>
                <p>Your friendly guide to creating beautiful, accessible color palettes. No design experience required!</p>
                <div class="simulation-control">
                    <label for="simType">Accessibility Simulation:</label>
                    <select id="simType">
                        <option value="none">None</option>
                        <option value="protanopia">Protanopia</option>
                        <option value="deuteranopia">Deuteranopia</option>
                        <option value="tritanopia">Tritanopia</option>
                        <option value="achromatopsia">Achromatopsia</option>
                    </select>
                </div>
            </header>
    
            <section class="controls">
                 <div class="controls-row">
                    <div class="control-group">
                        <label for="colorPicker" data-tooltip="This is the main color your palette is based on.">Base:</label>
                        <input type="color" id="colorPicker">
                        <div class="slider-group" data-tooltip="How many colors to generate (3 to 9).">
                            <div><label for="swatchCount">Size:</label><span id="swatchCountLabel">5</span></div>
                            <input type="range" id="swatchCount" min="3" max="9" value="5">
                        </div>
                    </div>
                    <div class="control-group">
                        <label data-tooltip="How your colors relate to each other. Try different ones!">Harmony:</label>
                        <div class="toggle-buttons" id="ruleButtons">
                            <button data-mode="monochromatic">Mono</button>
                            <button data-mode="shades">Shades</button>
                            <button data-mode="analogous">Analog</button>
                            <button data-mode="complementary">Comp</button>
                            <button data-mode="split-complementary">Split</button>
                            <button data-mode="triadic">Triad</button>
                            <button data-mode="tetradic">Tetrad</button>
                        </div>
                    </div>
                </div>
                <div class="controls-row">
                     <div class="control-group-label">Global Adjustments (for unlocked colors)</div>
                     <div class="slider-group" data-tooltip="Slightly change the tint of all colors.">
                        <div><label for="adjHue">Hue</label><span id="adjHueLabel">0°</span></div>
                        <input type="range" id="adjHue" min="-30" max="30" value="0">
                    </div>
                     <div class="slider-group" data-tooltip="Make colors more or less vibrant.">
                        <div><label for="adjSaturation">Sat.</label><span id="adjSaturationLabel">0%</span></div>
                        <input type="range" id="adjSaturation" min="-20" max="20" value="0">
                    </div>
                     <div class="slider-group" data-tooltip="Make colors lighter or darker.">
                        <div><label for="adjLightness">Light.</label><span id="adjLightnessLabel">0%</span></div>
                        <input type="range" id="adjLightness" min="-20" max="20" value="0">
                    </div>
                </div>
                 <div class="controls-row">
                    <div class="control-group">
                        <label data-tooltip="The primary format displayed.">Format:</label>
                        <div class="toggle-buttons" id="formatButtons">
                            <button data-format="hex">HEX</button>
                            <button data-format="rgb">RGB</button>
                            <button data-format="hsl">HSL</button>
                        </div>
                    </div>
                     <div class="action-buttons control-group">
                        <button id="saveFavoriteBtn" data-tooltip="Save current palette to Favorites"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17 3H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H7V5h10v14zM12 7c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg> Save</button>
                        <button id="shuffleBtn" data-tooltip="Shuffle unlocked colors"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg></button>
                        <button id="randomBtn" data-tooltip="Generate a new random palette"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2.5 15.5c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm0-10c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2-2zm-7 10c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg></button>
                        <button id="exportBtn" data-tooltip="Export palette as code"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg></button>
                    </div>
                </div>
            </section>
    
            <main class="palette-grid" id="paletteGrid"></main>
        </div>
        <aside class="sidebar" id="sidebar">
            <section class="sidebar-section">
                <h3>How to Use This Page</h3>
                <div class="how-to-guide">
                    <div class="how-to-step">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c1.38 0 2.69-.28 3.88-.78l-1.06-1.06c-1.3.56-2.73.84-4.22.84-4.41 0-8-3.59-8-8s3.59-8 8-8c1.18 0 2.29.26 3.32.72L16.53 3.5C15.14 2.56 13.62 2 12 2zm10.71 9.29l-3-3c-.39-.39-1.02-.39-1.41 0l-7.59 7.59c-.19.19-.34.42-.44.68l-1.4 4.19c-.11.34.02.71.29.98.27.27.64.4.98.29l4.19-1.4c.26-.1.49-.25.68-.44l7.59-7.59c.39-.39.39-1.02 0-1.41zM18.5 11.41L15 14.91l-2.09-2.09L16.41 9.3z"/></svg>
                        <div class="how-to-step-content">
                             <h4>1. Start with a Color</h4>
                             <p>Click the colorful circle under <strong>Base</strong> to pick your favorite starting color. This is the anchor for your whole palette.</p>
                        </div>
                    </div>
                    <div class="how-to-step">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5.5c-4.69 0-8.5 3.81-8.5 8.5s3.81 8.5 8.5 8.5 8.5-3.81 8.5-8.5-3.81-8.5-8.5-8.5zM12 21c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7z"/><path d="M12 11l1.5 5h-3zM11 6h2v3h-2z"/></svg>
                         <div class="how-to-step-content">
                             <h4>2. Explore Harmonies</h4>
                             <p>Select a <strong>Harmony</strong> rule (like 'Analog' or 'Comp') to see different styles. This is the best way to discover new combinations.</p>
                        </div>
                    </div>
                     <div class="how-to-step">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>
                         <div class="how-to-step-content">
                             <h4>3. Refine and Perfect</h4>
                             <p>See a color you love? Click the <strong>Lock</strong> icon on its card. Then, press the <strong>Shuffle</strong> button to generate new colors that work with your locked choice.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="sidebar-section">
                <h3>Palette Guide</h3>
                <div id="paletteGuideContent">
                    <p class="tip-text"></p>
                    <div class="usage-example" id="usageExample">
                        <h4>How to Apply This Palette</h4>
                        <div class="usage-example-dominant">
                            <span class="usage-label" id="usageDomLabel"></span>
                            <div class="usage-example-secondary">
                                <span class="usage-label" id="usageSecLabel"></span>
                            </div>
                            <div class="usage-example-accent">
                                <span class="usage-label" id="usageAccLabel"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

             <section class="sidebar-section">
                <h3>Live UI Preview</h3>
                <div class="preview-card" id="livePreview">
                    <h4>Example Component</h4>
                    <p>This shows how your colors can be used together in a real design.</p>
                    <button class="preview-button">Primary Action</button>
                </div>
            </section>

             <section class="sidebar-section">
                <h3>Gradient Studio</h3>
                <div class="gradients-grid" id="gradientsGrid"></div>
            </section>

            <section class="sidebar-section">
                <h3>Favorites</h3>
                <div id="favoritesList"><div id="noFavoritesMessage">Save a palette to see it here.</div></div>
            </section>
        </aside>
    </div>

    <div class="modal-overlay" id="exportModalOverlay">
        <div class="modal" id="exportModal">
            <h2>Export Palette</h2>
            <div class="modal-tabs" id="exportTabs">
                <button class="active" data-export-format="css">CSS</button>
                <button data-export-format="scss">SCSS</button>
                <button data-export-format="json">JSON</button>
                <button data-export-format="tailwind">Tailwind</button>
            </div>
            <textarea id="exportOutput" readonly spellcheck="false"></textarea>
            <div class="modal-actions">
                <span class="copy-feedback" id="copyFeedback"></span>
                <div>
                    <button id="copyExportBtn">Copy to Clipboard</button>
                    <button id="closeModalBtn">Close</button>
                </div>
            </div>
        </div>
    </div>
    
<!--
/**************************************************************
*
*   JAVASCRIPT LOGIC - TITAN EDITION (FINAL GUIDANCE UPDATE)
*
**************************************************************/
-->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        
        // --- 1. STATE & UI ---
        const state = {
            baseColor: '#5086f7',
            mode: 'monochromatic',
            count: 5,
            displayFormat: 'hex',
            locked: Array(9).fill(null), 
            palette: [],
            adjustments: { hue: 0, saturation: 0, lightness: 0 },
            favorites: [],
        };

        const ui = {
            body: document.body,
            colorPicker: document.getElementById('colorPicker'),
            ruleButtons: document.getElementById('ruleButtons'),
            formatButtons: document.getElementById('formatButtons'),
            paletteGrid: document.getElementById('paletteGrid'),
            randomBtn: document.getElementById('randomBtn'),
            shuffleBtn: document.getElementById('shuffleBtn'),
            exportBtn: document.getElementById('exportBtn'),
            swatchCount: document.getElementById('swatchCount'),
            swatchCountLabel: document.getElementById('swatchCountLabel'),
            adjHue: document.getElementById('adjHue'), adjHueLabel: document.getElementById('adjHueLabel'),
            adjSaturation: document.getElementById('adjSaturation'), adjSaturationLabel: document.getElementById('adjSaturationLabel'),
            adjLightness: document.getElementById('adjLightness'), adjLightnessLabel: document.getElementById('adjLightnessLabel'),
            simType: document.getElementById('simType'),
            livePreview: document.getElementById('livePreview'),
            gradientsGrid: document.getElementById('gradientsGrid'),
            favoritesList: document.getElementById('favoritesList'),
            saveFavoriteBtn: document.getElementById('saveFavoriteBtn'),
            exportModalOverlay: document.getElementById('exportModalOverlay'), exportModal: document.getElementById('exportModal'),
            exportTabs: document.getElementById('exportTabs'), exportOutput: document.getElementById('exportOutput'),
            copyExportBtn: document.getElementById('copyExportBtn'), closeModalBtn: document.getElementById('closeModalBtn'),
            copyFeedback: document.getElementById('copyFeedback'),
            paletteGuideTipText: document.querySelector('#paletteGuideContent .tip-text'),
            usageExample: document.getElementById('usageExample'),
            usageDomLabel: document.getElementById('usageDomLabel'),
            usageSecLabel: document.getElementById('usageSecLabel'),
            usageAccLabel: document.getElementById('usageAccLabel'),
        };
        const colorNameCache = new Map();
        
        const harmonyTips = {
            monochromatic: {
                tip: "<strong>Safest bet:</strong> Impossible to clash colors. Use the darkest for text, lightest for backgrounds, and a mid-tone for buttons to create a clean, minimalist look.",
                usage: { dominant: 4, secondary: 0, accent: 2 } 
            },
            shades: {
                tip: "<strong>For creating depth:</strong> Perfect for layers. Use the lightest shades for backgrounds, medium ones for cards, and the darkest for text and borders.",
                usage: { dominant: 0, secondary: 1, accent: 3 }
            },
            analogous: {
                tip: "<strong>For a natural feel:</strong> These colors are neighbors and always look good together, like a sunset. Use one for the main theme and the others for support.",
                usage: { dominant: 0, secondary: 4, accent: 2 }
            },
            complementary: {
                tip: "<strong>To make things POP:</strong> These are opposites. Use one for most of the page and its opposite for something you want people to click, like a 'Sign Up' button.",
                usage: { dominant: 0, secondary: 1, accent: 3 }
            },
            'split-complementary': {
                tip: "<strong>High contrast, less tension:</strong> A great choice for beginners. Use the main color for your background and the two opposing colors for highlights and details.",
                usage: { dominant: 0, secondary: 4, accent: 2 }
            },
            triadic: {
                tip: "<strong>For a vibrant look:</strong> Use the '60-30-10 Rule'. Pick one color as your <strong>main</strong> color (60%), a second for <strong>secondary</strong> elements (30%), and the third for small <strong>accents</strong> (10%).",
                usage: { dominant: 0, secondary: 2, accent: 4 }
            },
            tetradic: {
                tip: "<strong>Rich & diverse:</strong> This gives you the most options. Try pairing a dark and light color for background/text, and use the other two for colorful accents.",
                usage: { dominant: 0, secondary: 1, accent: 2 }
            }
        };

        // --- 2. COLOR UTILITIES ---
        const Color = {
            hexToRgb: hex => { const r = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return r ? { r: parseInt(r[1], 16), g: parseInt(r[2], 16), b: parseInt(r[3], 16) } : null; },
            rgbToHex: ({r,g,b}) => "#"+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1).toUpperCase(),
            rgbToHsl: ({r,g,b}) => { r/=255,g/=255,b/=255; let max=Math.max(r,g,b),min=Math.min(r,g,b); let h,s,l=(max+min)/2; if(max==min){h=s=0}else{let d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4} h/=6} return {h:h*360,s:s*100,l:l*100}; },
            hslToRgb: ({h,s,l}) => { s/=100,l/=100; let c=(1-Math.abs(2*l-1))*s,x=c*(1-Math.abs((h/60)%2-1)),m=l-c/2,r=0,g=0,b=0; if(0<=h&&h<60){r=c,g=x,b=0}else if(60<=h&&h<120){r=x,g=c,b=0}else if(120<=h&&h<180){r=0,g=c,b=x}else if(180<=h&&h<240){r=0,g=x,b=c}else if(240<=h&&h<300){r=x,g=0,b=c}else if(300<=h&&h<360){r=c,g=0,b=x} return {r:Math.round((r+m)*255),g:Math.round((g+m)*255),b:Math.round((b+m)*255)}; },
            getLuminance: ({r,g,b}) => [r,g,b].map(v=>{v/=255;return v<=0.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4)}).reduce((acc, v, i) => acc + v * [0.2126, 0.7152, 0.0722][i], 0),
        };
        async function fetchColorName(hex) {
            const cleanHex = hex.substring(1);
            if (colorNameCache.has(cleanHex)) return colorNameCache.get(cleanHex);
            try {
                const res = await fetch(`https://www.thecolorapi.com/id?hex=${cleanHex}`);
                const data = await res.json();
                const name = data.name.value;
                colorNameCache.set(cleanHex, name);
                return name;
            } catch (e) { return hex; }
        }

        // --- 3. PALETTE GENERATION ---
        function generatePalette() {
            const baseHsl = Color.rgbToHsl(Color.hexToRgb(state.baseColor));
            let paletteHsl = [];
            const hueStep = 30;
            for (let i = 0; i < state.count; i++) {
                if (state.locked[i]) { paletteHsl.push(Color.rgbToHsl(Color.hexToRgb(state.locked[i]))); continue; }
                let newHsl;
                const p = i - Math.floor(state.count / 2);
                const normalizedL = 15 + (80 * i) / (state.count - 1);
                switch (state.mode) {
                    case 'monochromatic': newHsl = { h: baseHsl.h, s: baseHsl.s - Math.abs(p * 5), l: Math.max(10, Math.min(95, baseHsl.l + p * 15)) }; break;
                    case 'shades': newHsl = { h: baseHsl.h, s: baseHsl.s, l: normalizedL }; break;
                    case 'analogous': newHsl = { h: (baseHsl.h + p * hueStep), s: baseHsl.s, l: Math.max(10, Math.min(95, baseHsl.l + p * 5)) }; break;
                    case 'complementary': newHsl = { h: (i % 2 === 0 ? baseHsl.h : (baseHsl.h + 180)), s: baseHsl.s, l: normalizedL }; break;
                    case 'split-complementary': { const comp = baseHsl.h + 180; newHsl = { h: i > Math.floor(state.count/2) ? (i % 2 !== 0 ? comp - hueStep : comp + hueStep) : baseHsl.h, s: baseHsl.s, l: normalizedL }; break; }
                    case 'triadic': newHsl = { h: (baseHsl.h + Math.floor(i / Math.ceil(state.count / 3)) * 120), s: baseHsl.s, l: normalizedL }; break;
                    case 'tetradic': newHsl = { h: (baseHsl.h + Math.floor(i / Math.ceil(state.count / 4)) * 90), s: baseHsl.s, l: normalizedL }; break;
                }
                paletteHsl.push(newHsl);
            }
            paletteHsl = paletteHsl.map((hsl, i) => {
                if (state.locked[i]) return hsl;
                return { h: (hsl.h + state.adjustments.hue + 360) % 360, s: Math.max(0, Math.min(100, hsl.s + state.adjustments.saturation)), l: Math.max(5, Math.min(95, hsl.l + state.adjustments.lightness)) };
            });
            state.palette = paletteHsl.map(hsl => Color.rgbToHex(Color.hslToRgb(hsl)));
            state.locked = state.palette.map((color, i) => state.locked[i] ? color : null);
        }

        // --- 4. RENDERING ---
        function fullRender() {
            ui.colorPicker.value = state.baseColor;
            ui.swatchCount.value = state.count; ui.swatchCountLabel.textContent = state.count;
            ui.ruleButtons.querySelectorAll('button').forEach(b => b.classList.toggle('active', b.dataset.mode === state.mode));
            ui.formatButtons.querySelectorAll('button').forEach(b => b.classList.toggle('active', b.dataset.format === state.displayFormat));
            ui.adjHue.value = state.adjustments.hue; ui.adjHueLabel.textContent = `${state.adjustments.hue}°`;
            ui.adjSaturation.value = state.adjustments.saturation; ui.adjSaturationLabel.textContent = `${state.adjustments.saturation}%`;
            ui.adjLightness.value = state.adjustments.lightness; ui.adjLightnessLabel.textContent = `${state.adjustments.lightness}%`;
            renderPaletteGrid();
            renderSidebar();
            updateURL();
        }

        function renderPaletteGrid() {
            ui.paletteGrid.innerHTML = state.palette.map((hex, i) => {
                const rgb = Color.hexToRgb(hex);
                const hsl = Color.rgbToHsl(rgb);
                const formats = { hex: { v: hex, d: hex }, rgb: { v: `rgb(${rgb.r},${rgb.g},${rgb.b})`, d: `${rgb.r},${rgb.g},${rgb.b}` }, hsl: { v: `hsl(${Math.round(hsl.h)},${Math.round(hsl.s)}%,${Math.round(hsl.l)}%)`, d: `${Math.round(hsl.h)}°,${Math.round(hsl.s)}%,${Math.round(hsl.l)}%` } };
                const formatKeys = ['hex', 'rgb', 'hsl'].sort((a, b) => a === state.displayFormat ? -1 : (b === state.displayFormat ? 1 : 0));
                const codesHTML = formatKeys.map(f => `<div class="color-code ${state.displayFormat === f ? 'primary-code' : ''}" data-value="${formats[f].v}" data-tooltip="Click to copy"><span class="type">${f}</span><span class="value">${formats[f].d}</span></div>`).join('');
                const locked = !!state.locked[i];
                return `
                <div class="color-card" style="animation-delay: ${i*50}ms; --glow-color: ${hex}33;">
                    <div class="card__header">
                         <h3 class="card__name" data-hex="${hex}"><span class="loading-dots"><span>.</span><span>.</span><span>.</span></span></h3>
                         <button class="lock-btn ${locked ? 'locked' : ''}" data-index="${i}" data-tooltip="${locked ? 'Unlock' : 'Lock'}"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF">${locked ? '<path d="M0 0h24v24H0z" fill="none"/><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z"/>' : '<path d="M0 0h24v24H0z" fill="none"/><path d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z"/>'}</svg></button>
                    </div>
                    <div class="card__swatch" style="background-color: ${hex};"></div>
                    <div class="card__info">
                        <div class="color-codes-wrapper">${codesHTML}</div>
                    </div>
                </div>`;
            }).join('');
            document.querySelectorAll('.card__name').forEach(el => fetchColorName(el.dataset.hex).then(name => el.textContent = name));
        }

        function renderSidebar() {
            const palette = state.palette.slice(0, state.count);
            if (palette.length < 2) return;

            // Live Preview
            const lumSorted = [...palette].map(hex => ({ hex, lum: Color.getLuminance(Color.hexToRgb(hex)) })).sort((a,b) => a.lum - b.lum);
            const bg = lumSorted[0].hex;
            const text = lumSorted[lumSorted.length - 1].hex;
            const accent = palette[Math.floor(palette.length / 2)];
            ui.livePreview.style.setProperty('--preview-bg', bg);
            ui.livePreview.style.setProperty('--preview-text', text);
            ui.livePreview.style.setProperty('--preview-accent', accent);
            ui.livePreview.style.setProperty('--preview-border', palette[1] || bg);

            // Gradients
            ui.gradientsGrid.innerHTML = palette.slice(0, -1).map((c, i) => `<div class="gradient-swatch" style="background: linear-gradient(135deg, ${c}, ${palette[i+1]})" data-tooltip="Copy CSS" data-css="linear-gradient(135deg, ${c}, ${palette[i+1]})"></div>`).join('');
            
            // Favorites
            renderFavorites();
            
            // Dynamic Aura
            if(palette.length >= 3) {
                document.documentElement.style.setProperty('--aura-color-1', `${accent}26`);
                document.documentElement.style.setProperty('--aura-color-2', `${bg}26`);
                document.documentElement.style.setProperty('--aura-color-3', `${text}26`);
            }

            // Palette Guide
            const tips = harmonyTips[state.mode];
            const usage = tips.usage;
            ui.paletteGuideTipText.innerHTML = tips.tip;

            const safeIndex = (i, arr) => Math.min(Math.max(0, i), arr.length - 1);
            const domIndex = safeIndex(usage.dominant, palette);
            const secIndex = safeIndex(usage.secondary, palette);
            const accIndex = safeIndex(usage.accent, palette);

            ui.usageExample.style.setProperty('--example-dom-color', palette[domIndex]);
            ui.usageExample.style.setProperty('--example-sec-color', palette[secIndex]);
            ui.usageExample.style.setProperty('--example-acc-color', palette[accIndex]);
            ui.usageDomLabel.textContent = `Dominant #${domIndex + 1}`;
            ui.usageSecLabel.textContent = `Secondary #${secIndex + 1}`;
            ui.usageAccLabel.textContent = `Accent #${accIndex + 1}`;
        }
        
        function renderFavorites() {
            if (state.favorites.length === 0) { ui.favoritesList.innerHTML = `<div id="noFavoritesMessage">Save a palette to see it here.</div>`; return; }
            ui.favoritesList.innerHTML = state.favorites.map((fav, i) => `
                <div class="favorite-item" data-index="${i}">
                    <div class="favorite-info"><div class="favorite-swatches">${fav.palette.map(c => `<div class="favorite-swatch" style="background-color:${c}"></div>`).join('')}</div><span class="favorite-name">${fav.name}</span></div>
                    <button class="delete-fav-btn" data-index="${i}" data-tooltip="Delete">&times;</button>
                </div>`).join('');
        }

        // --- 5. STATE MANAGEMENT ---
        function updateState(newState, shouldGenerate = true) {
            Object.assign(state, newState);
            if (newState.count !== undefined) { state.locked.length = state.count; state.locked.fill(null, state.count); }
            if (newState.baseColor || newState.mode) state.adjustments = { hue: 0, saturation: 0, lightness: 0 };
            if (shouldGenerate) generatePalette();
            fullRender();
        }
        function updateURL() {
            const data = { c: state.baseColor.substring(1), m: state.mode, n: state.count, d: state.displayFormat, l: state.locked.slice(0, state.count).map(c => c ? c.substring(1) : '-'), a: state.adjustments };
            history.replaceState(null, '', '#' + btoa(JSON.stringify(data)));
        }

        // --- 6. EVENT LISTENERS ---
        ui.colorPicker.addEventListener('input', e => updateState({ baseColor: e.target.value }));
        ui.swatchCount.addEventListener('input', e => updateState({ count: parseInt(e.target.value) }));
        ui.ruleButtons.addEventListener('click', e => e.target.tagName === 'BUTTON' && updateState({ mode: e.target.dataset.mode }));
        ui.formatButtons.addEventListener('click', e => e.target.tagName === 'BUTTON' && updateState({ displayFormat: e.target.dataset.format }, false));
        ['Hue', 'Saturation', 'Lightness'].forEach(prop => ui[`adj${prop}`].addEventListener('input', e => { state.adjustments[prop.toLowerCase()] = parseInt(e.target.value); updateState({}, true); }));
        ui.randomBtn.addEventListener('click', () => { state.locked.fill(null); updateState({ baseColor: '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0') }); });
        ui.shuffleBtn.addEventListener('click', () => updateState({ baseColor: '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0') }));
        ui.simType.addEventListener('change', e => { ui.body.className = e.target.value; });

        ui.paletteGrid.addEventListener('click', e => {
            if (e.target.closest('.lock-btn')) {
                const index = parseInt(e.target.closest('.lock-btn').dataset.index);
                state.locked[index] = state.locked[index] ? null : state.palette[index];
                updateState({}, false);
            } else if (e.target.closest('.color-code')) {
                const el = e.target.closest('.color-code');
                navigator.clipboard.writeText(el.dataset.value);
                el.classList.add('copied');
                setTimeout(() => el.classList.remove('copied'), 1500);
            }
        });

        ui.gradientsGrid.addEventListener('click', e => {
            if (e.target.classList.contains('gradient-swatch')) {
                navigator.clipboard.writeText(`background: ${e.target.dataset.css};`);
                const originalTooltip = e.target.dataset.tooltip;
                e.target.dataset.tooltip = 'CSS Copied!';
                setTimeout(() => { e.target.dataset.tooltip = originalTooltip; }, 2000);
            }
        });

        ui.saveFavoriteBtn.addEventListener('click', () => {
            const name = prompt("Enter a name for this palette:", `Palette ${state.favorites.length + 1}`);
            if (name) {
                state.favorites.push({ name, palette: state.palette.slice(0, state.count) });
                localStorage.setItem('auraFavorites', JSON.stringify(state.favorites));
                renderFavorites();
            }
        });
        
        ui.favoritesList.addEventListener('click', e => {
            const favItem = e.target.closest('.favorite-item'), delBtn = e.target.closest('.delete-fav-btn');
            if (delBtn) {
                e.stopPropagation();
                if(confirm("Are you sure?")) {
                    state.favorites.splice(parseInt(delBtn.dataset.index), 1);
                    localStorage.setItem('auraFavorites', JSON.stringify(state.favorites));
                    renderFavorites();
                }
            } else if (favItem) {
                const fav = state.favorites[parseInt(favItem.dataset.index)];
                state.locked.fill(null);
                fav.palette.forEach((color, i) => { state.palette[i] = color; state.locked[i] = color; });
                updateState({ count: fav.palette.length, baseColor: fav.palette[Math.floor(fav.palette.length/2)] }, false);
            }
        });

        const closeModal = () => ui.exportModalOverlay.classList.remove('visible');
        ui.exportBtn.addEventListener('click', () => {
            generateExportCode(ui.exportTabs.querySelector('.active')?.dataset.exportFormat || 'css');
            ui.exportModalOverlay.classList.add('visible');
        });
        ui.closeModalBtn.addEventListener('click', closeModal);
        ui.exportModalOverlay.addEventListener('click', (e) => e.target === ui.exportModalOverlay && closeModal());
        document.addEventListener('keydown', (e) => e.key === 'Escape' && ui.exportModalOverlay.classList.contains('visible') && closeModal());
        ui.exportTabs.addEventListener('click', (e) => { if (e.target.tagName === 'BUTTON') { ui.exportTabs.querySelector('.active')?.classList.remove('active'); e.target.classList.add('active'); generateExportCode(e.target.dataset.exportFormat); } });
        ui.copyExportBtn.addEventListener('click', () => { navigator.clipboard.writeText(ui.exportOutput.value).then(() => { ui.copyFeedback.textContent = 'Copied!'; ui.copyFeedback.style.opacity = 1; setTimeout(() => { ui.copyFeedback.style.opacity = 0; }, 2000); }); });
        
        function generateExportCode(format) {
            const currentPalette = state.palette.slice(0, state.count);
            let output = '';
            switch (format) {
                case 'css': output = ':root {\n' + currentPalette.map((c, i) => `  --color-${i + 1}: ${c};`).join('\n') + '\n}'; break;
                case 'scss': output = currentPalette.map((c, i) => `$color-${i + 1}: ${c};`).join('\n'); break;
                case 'json': output = `{\n  "colors": [\n    ${currentPalette.map(c => `"${c}"`).join(',\n    ')}\n  ]\n}`; break;
                case 'tailwind': output = `/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n  theme: {\n    extend: {\n      colors: {\n${currentPalette.map((c, i) => `        'brand-${i + 1}': '${c}',`).join('\n')}\n      }\n    }\n  }\n}`; break;
                default: output = "Invalid format.";
            }
            ui.exportOutput.value = output.trim();
        }

        // --- 7. INITIALIZATION ---
        function init() {
            state.favorites = JSON.parse(localStorage.getItem('auraFavorites')) || [];
            try {
                if (window.location.hash) {
                    const decoded = JSON.parse(atob(window.location.hash.substring(1)));
                    Object.assign(state, {
                        baseColor: '#' + decoded.c, mode: decoded.m, count: decoded.n, displayFormat: decoded.d,
                        locked: decoded.l.map(c => c === '-' ? null : '#' + c), adjustments: decoded.a
                    });
                }
            } catch (e) { console.error("Failed to parse state from URL hash.", e); }
            generatePalette();
            fullRender();
        }

        init();
    });
    </script>
</body>
</html>